{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pantheon Workflow Configuration",
  "description": "Schema for defining workflows in the Pantheon Multi-AI ecosystem",
  "type": "object",
  "required": ["name", "version", "stages"],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*$",
      "description": "Unique workflow identifier"
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Semantic version of the workflow"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the workflow purpose"
    },
    "triggers": {
      "type": "array",
      "items": {
        "enum": ["manual", "api_call", "webhook", "schedule", "event"]
      },
      "description": "How this workflow can be triggered"
    },
    "parameters": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type"],
        "properties": {
          "name": { "type": "string" },
          "type": { "enum": ["string", "number", "boolean", "object", "array"] },
          "required": { "type": "boolean", "default": false },
          "default": {},
          "description": { "type": "string" }
        }
      }
    },
    "stages": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["agent"],
        "properties": {
          "agent": {
            "type": "string",
            "description": "Agent to execute this stage"
          },
          "task": {
            "type": "string",
            "description": "Task description for the agent"
          },
          "depends_on": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Stages that must complete before this one"
          },
          "timeout": {
            "type": "string",
            "pattern": "^[0-9]+[smh]$",
            "description": "Timeout duration (e.g., '10m', '1h', '30s')"
          },
          "outputs": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Expected output files or artifacts"
          },
          "validation_required": {
            "type": "boolean",
            "default": false,
            "description": "Whether this stage requires validation"
          },
          "parallel_tasks": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Tasks that can run in parallel within this stage"
          },
          "gates": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Quality gates that must pass"
          },
          "success_criteria": {
            "type": "object",
            "additionalProperties": true,
            "description": "Criteria for stage success"
          },
          "retry_policy": {
            "type": "object",
            "properties": {
              "max_retries": { "type": "integer", "minimum": 0, "maximum": 5 },
              "backoff": { "enum": ["exponential", "linear", "constant"] }
            }
          },
          "on_failure": {
            "enum": ["fail", "continue", "skip", "fallback"],
            "description": "Action to take if stage fails"
          },
          "fallback_agent": {
            "type": "string",
            "description": "Alternative agent if primary fails"
          }
        }
      }
    },
    "global_settings": {
      "type": "object",
      "properties": {
        "max_parallel_stages": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3
        },
        "total_timeout": {
          "type": "string",
          "pattern": "^[0-9]+[smh]$",
          "description": "Maximum duration for entire workflow"
        },
        "validation_mode": {
          "enum": ["strict", "optional", "none"],
          "default": "strict"
        },
        "cost_limit": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum cost in dollars"
        },
        "notification_channels": {
          "type": "array",
          "items": { "enum": ["console", "webhook", "email", "slack"] }
        }
      }
    },
    "error_handling": {
      "type": "object",
      "properties": {
        "on_stage_failure": {
          "enum": ["abort", "continue", "rollback", "notify"],
          "default": "abort"
        },
        "on_validation_failure": {
          "enum": ["abort", "retry", "skip", "manual_review"],
          "default": "abort"
        },
        "on_timeout": {
          "enum": ["abort", "extend", "skip"],
          "default": "abort"
        },
        "max_total_retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 3
        }
      }
    }
  }
}