# /git Command - Git Integration Helper

## ACTIVATION

When the user types `/git [subcommand]`, provide git integration assistance.

## Overview

The `/git` command helps with git operations during BACO development workflows. By default, BACO automatically commits after each successful phase to preserve your work.

## AUTO-COMMIT BEHAVIOR (DEFAULT: ON)

BACO automatically commits your work:
- ✅ After each successful phase completion
- ✅ When tests pass (automatic test runs)
- ✅ With intelligent commit messages
- ❌ NOT when tests fail (unless forced)

To change this behavior:
- `/git auto-commit off` - Disable automatic commits
- `/git auto-commit on` - Re-enable automatic commits
- `/git auto-commit status` - Check current setting

## Subcommands

### `/git auto-commit [on|off|status]`
Control automatic commit behavior:

#### `/git auto-commit on` (Default)
Enable automatic commits after each phase:
```
✅ Auto-commit enabled
BACO will automatically commit after:
- Each successful phase
- Passing tests
- Successful operations
```

#### `/git auto-commit off`
Disable automatic commits:
```
⚠️ Auto-commit disabled
You'll need to manually commit using:
- /git commit
- git commit
```

#### `/git auto-commit status`
Check current auto-commit setting:
```
Auto-commit: [ON/OFF]
Last auto-commit: [timestamp]
Commits this session: [count]
```

### `/git init`
Initialize a git repository with appropriate settings:
```bash
git init --initial-branch=main
# Create .gitignore based on project type
# Make initial commit
```

### `/git commit`
Create a well-structured commit with automatic test verification:

1. **Test Verification** (automatic by default)
   ```bash
   # Auto-detect and run appropriate test command:
   npm test       # Node.js projects
   pytest         # Python projects
   cargo test     # Rust projects
   go test ./...  # Go projects
   ```
   
2. **Handle Test Results**
   - ✅ Tests pass → Continue to commit
   - ❌ Tests fail → Show options:
     ```
     ⚠️ Tests failed! 
     
     Options:
     1. Fix tests before committing (recommended)
     2. Commit with [WIP] prefix
     3. Skip commit
     4. Commit without running tests (use cautiously)
     
     Choice (1-4):
     ```
   - No tests found → Note this and continue

3. **Create Commit** (if tests pass or user chooses to proceed)
   ```bash
   git add -A
   git commit -m "[type]: [description]
   
   [optional body]
   
   Generated by BACO"
   ```

4. **Smart Commit Messages**
   Analyze changes to suggest appropriate commit type:
   - New features → `feat: `
   - Bug fixes → `fix: `
   - Tests → `test: `
   - Documentation → `docs: `
   - Refactoring → `refactor: `
   - Performance → `perf: `

Note: Use `/git test-mode skip` to disable test verification temporarily.

### `/git branch`
Create feature branches following conventions:
```bash
git checkout -b feature/[feature-name]
# or
git checkout -b fix/[issue-description]
# or
git checkout -b docs/[doc-update]
```

### `/git pr`
Create a pull request with comprehensive description:
1. Push current branch
2. Use gh CLI or provide instructions
3. Generate PR description from workflow

### `/git status`
Show enhanced git status with BACO context:
```
Current branch: feature/user-auth
Commits since main: 5
BACO phases completed: 3/5
Files created by BACO: 12
Test coverage: 85%
Auto-commit: ON
Test mode: strict
```

### `/git create-repo`
**Alias for `/gh create`** - Create a new GitHub repository for the current project.
See `/gh create` for full functionality.

### `/git push`
**Alias for `/gh push`** - Smart push with test verification and conflict prevention.
See `/gh push` for full functionality.

### `/git gh-status`
**Alias for `/gh status`** - Show comprehensive GitHub repository status.
See `/gh status` for full functionality.


### `/git test-mode [strict/relaxed/skip]`
Configure test requirements before commits:
- **strict** (default): Tests must pass before committing
- **relaxed**: Tests run but failures allow commit with warning
- **skip**: Don't run tests before commits (not recommended)

Example:
```
/git test-mode relaxed
✅ Test mode set to: relaxed
⚠️ Failed tests will now allow commits with [WIP] prefix
```

## Integration with Workflows

Git integration is **enabled by default** in BACO workflows:

1. **Automatic Initialization**: Git repo created at project start
2. **Auto-commit after each phase**: With test verification
3. **Smart commit messages**: Based on phase and changes
4. **Test-before-commit**: Ensures code quality
5. **Tag milestones**: Major features get tagged
6. **PR-ready**: Generate comprehensive PR descriptions

To disable for a session: `/git auto-commit off`
To change test behavior: `/git test-mode [strict/relaxed/skip]`

## Commit Message Templates

### Feature Commits
```
feat: add user authentication

- Implement JWT-based auth
- Add login/logout endpoints
- Create auth middleware
- Add comprehensive tests

Phase: Authentication
Coverage: 92%
```

### Fix Commits
```
fix: resolve token expiration issue

- Update token validation logic
- Add proper error handling
- Fix edge case with refresh tokens

Fixes: #123
```

### Refactor Commits
```
refactor: improve error handling architecture

- Centralize error handling
- Add custom error classes
- Improve error messages
- No functional changes

Phase: Code Quality
```

## Branch Strategies

### GitHub Flow (Default)
- main: Production-ready code
- feature/*: New features
- fix/*: Bug fixes
- docs/*: Documentation

### GitFlow
- main: Production releases
- develop: Integration branch
- feature/*: Features
- release/*: Release prep
- hotfix/*: Emergency fixes

## PR Generation

Automatically generate PR descriptions including:
- Summary of changes
- Features implemented
- Test results
- Breaking changes
- Related issues
- Screenshots (if applicable)

## Best Practices

1. **Atomic Commits**: One logical change per commit
2. **Clear Messages**: Descriptive, conventional commits
3. **Regular Commits**: Commit completed work frequently
4. **Test Before Push**: Ensure tests pass
5. **Update PR**: Keep PR description current

## Usage Examples

### Initialize with BACO project
```
/git init
> Initializing git repository...
> Created .gitignore for Node.js project
> Initial commit: "Initial project setup by BACO"
✅ Git repository initialized
```

### Create feature branch
```
/git branch user-profile
> Creating feature branch...
> Switched to branch 'feature/user-profile'
✅ Ready for development
```

### Commit with context
```
/git commit
> Analyzing changes...
> Detected: 5 new files, 3 modified
> Suggested message: "feat: implement user profile

- Add profile component
- Create profile API endpoint
- Add profile tests
- Update user model

Phase: User Profile
Coverage: 88%"

Commit? (y/n/edit):
```

### Create PR
```
/git pr
> Preparing pull request...
> Branch: feature/user-profile → main
> Commits: 8
> Changes: +523 -45

Creating PR with:
- Title: Implement user profile feature
- Labels: enhancement, baco-generated
- Description: [Generated from workflow]

✅ PR created: https://github.com/user/repo/pull/42
```

## Error Handling

Common issues and solutions:
- **No remote**: Prompt to add remote
- **Uncommitted changes**: Show what needs committing
- **Behind main**: Suggest rebase or merge
- **Conflicts**: Guide through resolution

Remember: Git integration enhances BACO workflows with version control best practices.