# /gh - GitHub Integration Command

## ACTIVATION
When the user types `/gh [subcommand]`, provide GitHub integration assistance using the `gh` CLI.

## Overview
The `/gh` command provides seamless GitHub integration for BACO projects, handling repository creation, smart pushing, and status monitoring.

## SUBCOMMANDS

### `/gh create`
Create a GitHub repository for the current project.

#### Process:
1. **Check Authentication**
   ```bash
   gh auth status
   ```
   - Parse output for "Logged in to github.com as [USERNAME]"
   - If not authenticated, guide user: "âš ï¸ GitHub authentication required. Please run: `gh auth login`"
   - After auth, confirm: "âœ… Authenticated as: [USERNAME]"

2. **Gather Repository Information**
   - Default name: Current directory name
   - Ask: "Repository name? (default: [current-dir])"
   - Ask: "Public or private? (default: private)"
   - Ask: "Description? (optional)"

3. **Create Repository**
   ```bash
   gh repo create [name] --[visibility] --description "[description]" --clone
   ```
   - Parse output: Extract URL from line starting with "https://github.com/"
   - Store the extracted URL for display

4. **Initialize Git (if needed)**
   ```bash
   git init --initial-branch=main
   ```

5. **Generate Professional Files**
   - Create `.gitignore` based on project type
   - Generate `README.md` with project information
   - Show: "âœ… Created .gitignore and README.md"

6. **Test Verification** (if project has tests)
   ```
   ğŸ§ª Running tests before initial commit...
   ```
   - If tests exist and pass: âœ… Continue
   - If tests fail:
     ```
     âš ï¸ Tests failed in new project
     
     Options:
     1. Fix tests before creating repository
     2. Create repository anyway (tests can be fixed later)
     3. Cancel repository creation
     
     Choice (1-3):
     ```
   - No tests found: Continue (common for new projects)

7. **Initial Commit and Push**
   ```bash
   git add -A
   git commit -m "Initial commit - BACO project setup

   Generated by BACO"
   git push -u origin main
   ```

8. **Success Message**
   ```
   âœ… Repository created successfully!
   
   ğŸŒ Live at: [extracted URL]
   ğŸ“‹ Clone: git clone [extracted URL]
   ğŸ¤ Add collaborators: [extracted URL]/settings/access
   ```

### `/gh push`
Smart push with test verification and safety checks to prevent conflicts.

#### Process:
1. **Check Remote**
   ```bash
   git remote -v
   ```
   - If no remote: "âŒ No remote repository. Run `/gh create` first."

2. **Run Tests Before Push** (automatic by default)
   ```
   ğŸ§ª Running tests before push...
   ```
   - Auto-detect and run appropriate test command
   - If tests pass: âœ… Continue to push
   - If tests fail:
     ```
     âŒ Tests failed!
     
     Pushing broken code can break CI/CD pipelines and affect other developers.
     
     Options:
     1. Fix tests first (recommended)
     2. Push anyway with warning commit
     3. Cancel push
     
     Choice (1-3):
     ```
   - If option 2: Create warning commit first:
     ```bash
     git add -A
     git commit -m "âš ï¸ [WIP] Pushing with failing tests - fix needed"
     ```
   - No tests found: Note and continue
   
   Note: Use `/git test-mode skip` to disable test verification

3. **Fetch Latest**
   ```bash
   git fetch origin
   ```

4. **Check Status**
   ```bash
   git status -sb
   ```
   - Parse output:
     - `[ahead X]` only â†’ Safe to push
     - `[behind Y]` only â†’ Need to pull
     - `[ahead X, behind Y]` â†’ Diverged
     - No brackets â†’ Up to date

4. **Handle Each Case**
   
   **If ahead only:**
   ```bash
   git push origin main
   ```
   Show: "âœ… Pushed [X] commits to GitHub"
   
   **If behind:**
   ```
   âš ï¸ Your branch is behind by [Y] commits.
   
   Options:
   1. Merge: git pull origin main
   2. Rebase: git pull --rebase origin main  
   3. Review: git log origin/main..HEAD
   
   Which approach? (1/2/3):
   ```
   
   **If diverged:**
   ```
   âš ï¸ Your branch has diverged (ahead [X], behind [Y])
   
   This requires manual resolution:
   1. Merge: git pull origin main (may create merge commit)
   2. Rebase: git pull --rebase origin main (cleaner history)
   3. Force: git push --force (âš ï¸ overwrites remote)
   
   Recommendation: Option 2 for clean history
   Which approach? (1/2/3):
   ```
   
   **If up to date:**
   ```
   âœ… Already up to date with GitHub
   ```

### `/gh status`
Show comprehensive GitHub repository status.

#### Process:
1. **Get Repository Info**
   ```bash
   gh repo view --json name,owner,url,defaultBranchRef,isPrivate,description
   ```
   - Parse JSON output for structured data

2. **Get Git Status**
   ```bash
   git status -sb
   ```
   - Parse for branch name and ahead/behind counts

3. **Get Recent Activity**
   ```bash
   git log --oneline -5
   ```

4. **Display Formatted Status**
   ```
   ğŸ“Š GitHub Repository Status
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   Repository: [owner]/[name]
   URL: [url]
   Visibility: [Private/Public]
   Description: [description]
   
   Branch: [current] â†’ [remote]
   Status: [Ahead X / Behind Y / Up to date]
   
   Recent commits:
   â€¢ [commit 1]
   â€¢ [commit 2]
   â€¢ [commit 3]
   
   Quick actions:
   - Push changes: /gh push
   - View on GitHub: [url]
   - Check issues: gh issue list
   ```

### `/gh`
Show help when no subcommand is provided:
```
ğŸ™ GitHub Integration Commands
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Available commands:
â€¢ /gh create  - Create a new GitHub repository
â€¢ /gh push    - Smart push with conflict prevention  
â€¢ /gh status  - Show repository status

Quick tips:
- First time? Run '/gh create' to set up GitHub
- Use '/gh push' instead of 'git push' for safety
- Check '/gh status' to see your repository state

Need GitHub CLI? Install with:
- macOS: brew install gh
- Linux: See https://github.com/cli/cli#installation
```

## INTEGRATION WITH BACO WORKFLOW

When BACO completes project implementation, it should offer GitHub integration:
```
âœ… Project implementation complete!

Would you like to create a GitHub repository?
â†’ Use '/gh create' to set up GitHub
â†’ Or continue with local development
```

## ERROR HANDLING

### Common Issues:

1. **Not Authenticated**
   ```
   âš ï¸ GitHub CLI not authenticated
   
   To fix:
   1. Run: gh auth login
   2. Choose: GitHub.com
   3. Choose: Login with web browser
   4. Complete authentication
   5. Return here and try again
   ```

2. **Repository Already Exists**
   ```
   âŒ Repository '[name]' already exists
   
   Options:
   1. Use a different name
   2. Delete existing: gh repo delete [name]
   3. Connect to existing: git remote add origin [url]
   ```

3. **Network Issues**
   ```
   âŒ Failed to connect to GitHub
   
   Check:
   - Internet connection
   - GitHub status: https://githubstatus.com
   - Firewall/proxy settings
   ```

## BEST PRACTICES

1. **Always fetch before push** - Prevents conflicts
2. **Use descriptive commits** - Help future you
3. **Keep README updated** - First thing people see
4. **Regular pushes** - Don't lose work
5. **Check status often** - Stay synchronized

## PARSING PATTERNS

When parsing command outputs:
- `gh auth status`: Look for "Logged in to github.com as"
- `gh repo create`: Extract URL after "https://github.com/"
- `git status -sb`: Parse [ahead X, behind Y] patterns
- `gh repo view --json`: Parse as standard JSON

Remember: This command enhances BACO workflows with professional GitHub integration.